<div class="customLoading">
    <div class="customLoader"></div>
</div>
<div class="contract-area">

    <form [formGroup]="createContractFormGroup">

        <div class="row">
            <!-- Textual inputs start -->
            <div class="col-12 mt-5">
                <div class="card">
                    <div class="card-body">
                        <h4 class="header-title">Tạo hợp đồng</h4>
                        <div class="row">
                            <div class="col-sm-6">
                                <label class="col-form-label required">Chọn phòng ký hợp đồng</label>
                                <mat-form-field class="example-full-width">
                                    <input type="text" id='room-name' placeholder="Điền tên phòng" aria-label="Assignee"
                                        matInput [matAutocomplete]="auto" formControlName="room">
                                    <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn"
                                        (optionSelected)="onChooseRoom($event.option.value)">
                                        <mat-option *ngFor="let option of filteredOptions | async" [value]="option">
                                            {{option.name}}
                                        </mat-option>
                                    </mat-autocomplete>
                                </mat-form-field>
                                <div *ngIf="createContractFormGroup.controls['room'].hasError('required') && (createContractFormGroup.controls['room'].dirty || createContractFormGroup.controls['room'].touched)"
                                    class="alert alert-danger">
                                    Tên phòng là bắt buộc
                                </div>
                            </div>
                        </div>
                        <div class="row" *ngIf='listContractDisplay.length > 0'>
                                <div *ngFor="let mess of listContractDisplay" class="alert alert-warning col-sm-7 ml-2" role="alert">
                                       {{mess}}
                                </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-6">
                                <label class="col-form-label">Chọn khách thuê</label>
                                <div class="form-inline md-form mr-auto mb-4">
                                    <input class="form-control mr-3 col-sm-6" type="text"
                                        placeholder="Nhập số điện thoại" aria-label="Search"
                                        formControlName="tenantSearch">
                                    <button class="btn btn-rounded btn-secondary" (click)="searchByPhone()">Tìm
                                        kiếm</button>
                                </div>
                                <div *ngIf="createContractFormGroup.controls['tenantSearch'].hasError('pattern') && (createContractFormGroup.controls['tenantSearch'].dirty || createContractFormGroup.controls['tenantSearch'].touched)"
                                    class="alert alert-danger">
                                    Số điện thoại không đúng định dạng
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <label class="col-form-label">Danh sách khách thuê</label>
                                <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
                                    <ng-container matColumnDef="name">
                                        <th mat-header-cell *matHeaderCellDef>Tên khách</th>
                                        <td mat-cell *matCellDef="let element"> {{element.user.name}} </td>
                                    </ng-container>
                                    <ng-container matColumnDef="phone">
                                        <th mat-header-cell *matHeaderCellDef>Số điện thoại</th>
                                        <td mat-cell *matCellDef="let element"> {{element.user.phone}} </td>
                                    </ng-container>

                                    <ng-container matColumnDef="customColumn">
                                        <th mat-header-cell *matHeaderCellDef></th>
                                        <td mat-cell *matCellDef="let row">
                                            <ul class="d-flex justify-content-center">
                                                <li><a class="text-danger" (click)="deleteRoom(row)"><i
                                                            class="ti-trash"></i></a></li>
                                            </ul>
                                        </td>
                                    </ng-container>
                                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                                </table>

                            </div>
                        </div>

                        <div class="form-group row mt-3">
                            <div class="col-sm-4">
                                <label class="col-form-label required">Người đại diện</label>
                                <select class="custom-select" formControlName="owner" id='select-owner'>
                                    <option *ngFor="let element of listTenant" [ngValue]="element">
                                        {{element.user.name}}
                                    </option>
                                </select>
                                <div *ngIf="createContractFormGroup.controls['owner'].hasError('required') && (createContractFormGroup.controls['owner'].dirty || createContractFormGroup.controls['owner'].touched)"
                                    class="alert alert-danger">
                                    Người đại diện là bắt buộc
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <label for="example-text-input" class="col-form-label required">Giá phòng</label>
                                <div class="input-group">
                                    <input type="text" class="form-control input-price" formControlName="price">
                                    <div class="input-group-append">
                                        <span class="input-group-text">Đồng</span>
                                    </div>
                                </div>
                                <div *ngIf="createContractFormGroup.controls['price'].hasError('required') && (createContractFormGroup.controls['price'].dirty || createContractFormGroup.controls['price'].touched)"
                                    class="alert alert-danger">
                                    Giá phòng là bắt buộc
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <label for="example-text-input" class="col-form-label">Đặt cọc</label>
                                <div class="input-group">
                                    <input type="text" class="form-control input-price" formControlName="deposit">
                                    <div class="input-group-append">
                                        <span class="input-group-text">Đồng</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-sm-4">
                                <label for="example-text-input" class="col-form-label required">Thời gian bắt đầu</label>
                                <div class="input-group">
                                    <mat-form-field>
                                        <input matInput [min]="minDate" formControlName="beginDate" placeholder="Bấm để chọn"
                                            [matDatepicker]="picker" >
                                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                        <mat-datepicker #picker (monthSelected)="monthStartSelected($event,picker)"
                                            startView="multi-year" disabled="false"></mat-datepicker>
                                    </mat-form-field>
                                </div>
                            </div>



                            <div class="col-sm-4">
                                <label for="example-text-input"class="col-form-label required">Thời gian kết thúc</label>
                                <div class="input-group">
                                    <mat-form-field>
                                        <input matInput  [min]="minDate"  [matDatepicker]="picker2" placeholder="Bấm để chọn"
                                        formControlName="endDate" >
                                        <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                                        <mat-datepicker #picker2 (monthSelected)="monthEndSelected($event,picker2)"
                                            startView="multi-year" disabled="false"></mat-datepicker>
                                    </mat-form-field>
                                 
                                </div>
                            </div>


                            <div class="col-sm-4">
                                <label for="example-text-input" class="col-form-label">Thời hạn hợp đồng</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id='period' formControlName="period"
                                        disabled>
                                    <div class="input-group-append">
                                        <span class="input-group-text">Tháng</span>
                                    </div>
                                </div>


                            </div>
                        </div>
                        <!-- extra fee   -->
                        <div class="form-group row">
                            <div class="col-sm-4">
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" id="customCheck1">
                                    <label class="custom-control-label" for="customCheck1">Tăng / giảm tiền phòng tháng
                                        đầu tiên </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row collapse" id="mycollapse">
                            <div class="col-sm-6 ">
                                <div class="custom-control custom-radio custom-control-inline">
                                    <input type="radio" checked="" id="increase" name="customRadio2"
                                        class="custom-control-input">
                                    <label class="custom-control-label" for="increase">Tăng </label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline">
                                    <input type="radio" id="decrease" name="customRadio2" class="custom-control-input">
                                    <label class="custom-control-label" for="decrease">Giảm</label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline">Số tiền này sẽ được thêm
                                    vào mục chi phí khác</div>
                                <div>
                                    <label for="example-text-input" class="col-form-label">Số tiền</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control input-price" id='extraFee'>
                                        <div class="input-group-append">
                                            <span class="input-group-text">Đồng</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <!-- end extra fee -->

                        <div class="custom-file col-sm-5 ml-2">
                            <input type="file" imageUpload accept="image/*" class="custom-file-input" id="customFile"
                                (imageSelected)="uploadImage($event)" [resizeOptions]="resizeOptions" multiple>
                            <label class="custom-file-label" for="customFile">Tải lên ảnh hợp đồng(Tối đa 5 ảnh)</label>

                        </div>
                        <!-- view image -->
                        <div class="row">
                            <div class="col-sm-4" *ngFor="let img of listImg, let i = index">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <img [src]="img" alt="" (click)='this.viewImg(img)'>
                                        <button (click)='deleteImage(i)' class="btn btn-rounded btn-danger mt-2">Xóa
                                            ảnh</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end view image -->


                        <div class="form-group row">
                            <div class="col-sm-11">
                                <label for="input-description" class="col-form-label">Mô tả</label>
                                <textarea class="form-control" rows="3" formControlName="description"></textarea>
                            </div>
                        </div>
                        <div class="mt-3 float-right col-sm-4 text-center"> 
                                <input routerLink="/landlord/contract" class="btn btn-secondary mb-3 mr-3" type="submit"
                                value="Trở về">
                            <input class="btn btn-info mb-3" type="submit" value="Tạo hợp đồng" (click)="onSubmit()"  [disabled]="createContractFormGroup.invalid" >
                        </div>
                        <!--  [disabled]="createContractFormGroup.invalid" -->
                    </div>

                </div>

            </div>
            <!-- Textual inputs end -->
        </div>

    </form>

</div>

<!-- modal view image -->

<div class="modal fade bd-example-modal-lg text-center" id="modal1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body">
                <img class="modalImg" alt="">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<!-- modal view profile tenant -->

<div class="modal fade bd-example-modal-lg text-center" id="modal2">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body">

                <div class="form-group row">
                    <label for="tenant-name" class="col-sm-2 col-form-label">Họ tên</label>
                    <div class="col-sm-10">
                        <input class="form-control" type="text" id="tenant-name" disabled>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="tenant-phone" class="col-sm-2 col-form-label">Số điện thoại</label>
                    <div class="col-sm-10">
                        <input class="form-control" type="text" id="tenant-phone" disabled>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="tenant-address" class="col-sm-2 col-form-label">Địa chỉ</label>
                    <div class="col-sm-10">
                        <input class="form-control" type="text" id="tenant-address" disabled>
                    </div>
                </div>

                <img src="" alt="" id='imgArnFront'>
                <div class="mt-2"></div>
                <img src="" alt="" id='imgArnBack'>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" data-dismiss="modal" (click)='saveTenant()'>Lưu khách
                    thuê</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>